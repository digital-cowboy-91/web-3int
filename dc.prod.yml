version: "3.8"
name: ${PROJECT_NAME}
services:
  cms:
    container_name: ${PROJECT_NAME}-cms
    image: directus/directus:10.8.3
    restart: always
    environment:
      KEY: ${KEY}
      SECRET: ${SECRET}

      # DB_CLIENT: ${DB_CLIENT}
      # DB_HOST: ${DB_HOST}
      # DB_PORT: ${DB_PORT}
      # DB_DATABASE: ${DB_DATABASE}
      # DB_USER: ${DB_USER}
      # DB_PASSWORD: ${DB_PASSWORD}
      # DB_SSL: ${DB_SSL}
      # DB_SSL__CA: ${DB_SSL__CA}
      # NODE_TLS_REJECT_UNAUTHORIZED: ${NODE_TLS_REJECT_UNAUTHORIZED}

      ADMIN_EMAIL: ${ADMIN_EMAIL}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}

      ZEPTOMAIL_URL: ${ZEPTOMAIL_URL}
      ZEPTOMAIL_TOKEN: ${ZEPTOMAIL_TOKEN}

      # EXTENSIONS_AUTO_RELOAD: "true"
    networks:
      - traefik_proxy
    volumes:
      - ${WORKDIR}/persist/database:/directus/database
      - ${WORKDIR}/temp/extensions:/directus/extensions
    labels:
      - traefik.http.routers.${PROJECT_NAME}-cms.rule=Host(`cms.3int.uk`)
      - traefik.http.routers.${PROJECT_NAME}-cms.entryPoints=websecure
      - traefik.http.routers.${PROJECT_NAME}-cms.tls.certResolver=web3int

  web:
    container_name: ${PROJECT_NAME}-web
    image: ${DO_CR_IMAGE}
    restart: always
    depends_on:
      - cms
    networks:
      - traefik_proxy
    volumes:
      - ${WORKDIR}/temp/extensions:/app/cms/extensions
    labels:
      - traefik.http.routers.${PROJECT_NAME}-web.rule=Host(`3int.uk`)
      - traefik.http.routers.${PROJECT_NAME}-web.entryPoints=websecure
      - traefik.http.routers.${PROJECT_NAME}-web.tls.certResolver=web3int

networks:
  traefik_proxy:
    external: true
